<!DOCTYPE html>

<html xmlns="http://www.w3.org/1999/xhtml">

<head>

<meta charset="utf-8" />
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<meta name="generator" content="pandoc" />

<meta name="viewport" content="width=device-width, initial-scale=1">

<meta name="author" content="Filip Schouwenaars" />


<title>Checking function calls</title>



<style type="text/css">code{white-space: pre;}</style>
<style type="text/css">
a.sourceLine { display: inline-block; line-height: 1.25; }
a.sourceLine { pointer-events: none; color: inherit; text-decoration: inherit; }
a.sourceLine:empty { height: 1.2em; position: absolute; }
.sourceCode { overflow: visible; }
code.sourceCode { white-space: pre; position: relative; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
code.sourceCode { white-space: pre-wrap; }
a.sourceLine { text-indent: -1em; padding-left: 1em; }
}
pre.numberSource a.sourceLine
  { position: relative; }
pre.numberSource a.sourceLine:empty
  { position: absolute; }
pre.numberSource a.sourceLine::before
  { content: attr(data-line-number);
    position: absolute; left: -5em; text-align: right; vertical-align: baseline;
    border: none; pointer-events: all;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {  }
@media screen {
a.sourceLine::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>



<style type="text/css">body {
background-color: #fff;
margin: 1em auto;
max-width: 700px;
overflow: visible;
padding-left: 2em;
padding-right: 2em;
font-family: "Open Sans", "Helvetica Neue", Helvetica, Arial, sans-serif;
font-size: 14px;
line-height: 1.35;
}
#header {
text-align: center;
}
#TOC {
clear: both;
margin: 0 0 10px 10px;
padding: 4px;
width: 400px;
border: 1px solid #CCCCCC;
border-radius: 5px;
background-color: #f6f6f6;
font-size: 13px;
line-height: 1.3;
}
#TOC .toctitle {
font-weight: bold;
font-size: 15px;
margin-left: 5px;
}
#TOC ul {
padding-left: 40px;
margin-left: -1.5em;
margin-top: 5px;
margin-bottom: 5px;
}
#TOC ul ul {
margin-left: -2em;
}
#TOC li {
line-height: 16px;
}
table {
margin: 1em auto;
border-width: 1px;
border-color: #DDDDDD;
border-style: outset;
border-collapse: collapse;
}
table th {
border-width: 2px;
padding: 5px;
border-style: inset;
}
table td {
border-width: 1px;
border-style: inset;
line-height: 18px;
padding: 5px 5px;
}
table, table th, table td {
border-left-style: none;
border-right-style: none;
}
table thead, table tr.even {
background-color: #f7f7f7;
}
p {
margin: 0.5em 0;
}
blockquote {
background-color: #f6f6f6;
padding: 0.25em 0.75em;
}
hr {
border-style: solid;
border: none;
border-top: 1px solid #777;
margin: 28px 0;
}
dl {
margin-left: 0;
}
dl dd {
margin-bottom: 13px;
margin-left: 13px;
}
dl dt {
font-weight: bold;
}
ul {
margin-top: 0;
}
ul li {
list-style: circle outside;
}
ul ul {
margin-bottom: 0;
}
pre, code {
background-color: #f7f7f7;
border-radius: 3px;
color: #333;
white-space: pre-wrap; 
}
pre {
border-radius: 3px;
margin: 5px 0px 10px 0px;
padding: 10px;
}
pre:not([class]) {
background-color: #f7f7f7;
}
code {
font-family: Consolas, Monaco, 'Courier New', monospace;
font-size: 85%;
}
p > code, li > code {
padding: 2px 0px;
}
div.figure {
text-align: center;
}
img {
background-color: #FFFFFF;
padding: 2px;
border: 1px solid #DDDDDD;
border-radius: 3px;
border: 1px solid #CCCCCC;
margin: 0 5px;
}
h1 {
margin-top: 0;
font-size: 35px;
line-height: 40px;
}
h2 {
border-bottom: 4px solid #f7f7f7;
padding-top: 10px;
padding-bottom: 2px;
font-size: 145%;
}
h3 {
border-bottom: 2px solid #f7f7f7;
padding-top: 10px;
font-size: 120%;
}
h4 {
border-bottom: 1px solid #f7f7f7;
margin-left: 8px;
font-size: 105%;
}
h5, h6 {
border-bottom: 1px solid #ccc;
font-size: 105%;
}
a {
color: #0033dd;
text-decoration: none;
}
a:hover {
color: #6666ff; }
a:visited {
color: #800080; }
a:visited:hover {
color: #BB00BB; }
a[href^="http:"] {
text-decoration: underline; }
a[href^="https:"] {
text-decoration: underline; }

code > span.kw { color: #555; font-weight: bold; } 
code > span.dt { color: #902000; } 
code > span.dv { color: #40a070; } 
code > span.bn { color: #d14; } 
code > span.fl { color: #d14; } 
code > span.ch { color: #d14; } 
code > span.st { color: #d14; } 
code > span.co { color: #888888; font-style: italic; } 
code > span.ot { color: #007020; } 
code > span.al { color: #ff0000; font-weight: bold; } 
code > span.fu { color: #900; font-weight: bold; }  code > span.er { color: #a61717; background-color: #e3d2d2; } 
</style>

</head>

<body>




<h1 class="title toc-ignore">Checking function calls</h1>
<h4 class="author"><em>Filip Schouwenaars</em></h4>



<p>Testing functions is probably one of the most common things you’ll do when writing SCTs. The functions in <code>testwhat</code> related to testing functions allow you to test whether students correctly called particular functions, with the correct arguments and whether these arguments are correct. To assess all of these aspects, <code>testwhat</code> goes through the solution code to see which functions were called there and how, and also checks the solution environment to see what the value of the parameters is. This makes the comparison of function calls concise yet robust.</p>
<div id="example-1-basic" class="section level2">
<h2>Example 1: Basic</h2>
<p>Suppose you want the student to call the <code>round()</code> function on <code>pi</code> (a value that’s available in R by default), as follows:</p>
<div class="sourceCode" id="cb1"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1-1" data-line-number="1"><span class="co"># Round pi to three digits</span></a>
<a class="sourceLine" id="cb1-2" data-line-number="2"><span class="kw">round</span>(pi, <span class="dv">3</span>)</a></code></pre></div>
<p>The following SCT tests whether the <code>round()</code> function is used correctly:</p>
<div class="sourceCode" id="cb2"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb2-1" data-line-number="1">fun &lt;-<span class="st"> </span><span class="kw">ex</span>() <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">check_function</span>(<span class="st">&quot;round&quot;</span>)</a>
<a class="sourceLine" id="cb2-2" data-line-number="2">fun <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">check_arg</span>(<span class="st">&quot;x&quot;</span>) <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">check_equal</span>()</a>
<a class="sourceLine" id="cb2-3" data-line-number="3">fun <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">check_arg</span>(<span class="st">&quot;digits&quot;</span>) <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">check_equal</span>()</a></code></pre></div>
<p>To find out which arguments you have to specify in <code>args</code>, you can use <code>args(round)</code>. This will show that the names of the arguments of the <code>round()</code> function are <code>x</code> and <code>digits</code>. When a student submits his code and SCT is executed, <code>check_function()</code> tests whether the student has called the function <code>round()</code>. Next, <code>check_arg()</code> checks whether each argument was specified. Finally, <code>check_equal()</code> checks whether the values of the argument are the same as in the solution. So in this case, it tests whether <code>round()</code> is used with the <code>x</code> argument equal to <code>pi</code> and the second argument equal to <code>3</code>. The above SCT would accept all of the following submissions:</p>
<ul>
<li><code>round(pi, 3)</code></li>
<li><code>round(pi, digits = 3)</code></li>
<li><code>round(x = pi, digits = 3)</code></li>
<li><code>round(digits = 3, x = pi)</code></li>
<li><code>round(pi, digits = 1 + 2)</code></li>
<li><code>round(digits = 5 - 2, pi^2/pi)</code></li>
</ul>
<div id="custom-messages" class="section level3">
<h3>Custom messages</h3>
<p>In case of a failure, <code>testwhat</code> will automatically generate meaningful feedback that’s specific to what the student did wrong, but you can also override these messages:</p>
<div class="sourceCode" id="cb3"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb3-1" data-line-number="1">fun &lt;-<span class="st"> </span><span class="kw">ex</span>() <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">check_function</span>(<span class="st">&quot;round&quot;</span>, <span class="dt">not_called_msg =</span> <span class="st">&quot;Have you used `round()` to round `pi`?&quot;</span>)</a>
<a class="sourceLine" id="cb3-2" data-line-number="2">fun <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb3-3" data-line-number="3"><span class="st">  </span><span class="kw">check_arg</span>(<span class="st">&quot;x&quot;</span>, <span class="dt">arg_not_specified_msg =</span> <span class="st">&quot;Have you specified the number to round?&quot;</span>) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb3-4" data-line-number="4"><span class="st">  </span><span class="kw">check_equal</span>(<span class="st">&quot;Have you correctly specified that `round()` should round `pi`?&quot;</span>)</a>
<a class="sourceLine" id="cb3-5" data-line-number="5">fun <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb3-6" data-line-number="6"><span class="st">  </span><span class="kw">check_arg</span>(<span class="st">&quot;digits&quot;</span>, <span class="dt">arg_not_specfied_msg =</span> <span class="st">&quot;Have you specified to how many digits the number should be rounded?&quot;</span>) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb3-7" data-line-number="7"><span class="st">  </span><span class="kw">check_equal</span>(<span class="st">&quot;Have you correctly set the `digits` argument to 3?&quot;</span>)</a></code></pre></div>
</div>
<div id="eval" class="section level3">
<h3><code>eval</code></h3>
<p>Inside <code>check_equal()</code>, you can use <code>eval</code> to control how parameters are checked:</p>
<ul>
<li>If <code>eval = FALSE</code>, the expressions of the parameters are compared as strings, not the value that results from evaluating the expression.</li>
<li>If <code>eval = TRUE</code>, which is the default, the expressions that are used to set the arguments are evaluated and their results compared.</li>
</ul>
<p>If you change the SCT as follows (which in this example is not a good idea!):</p>
<div class="sourceCode" id="cb4"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb4-1" data-line-number="1">fun &lt;-<span class="st"> </span><span class="kw">ex</span>() <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">check_function</span>(<span class="st">&quot;round&quot;</span>)</a>
<a class="sourceLine" id="cb4-2" data-line-number="2">fun <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">check_arg</span>(<span class="st">&quot;x&quot;</span>) <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">check_equal</span>(<span class="dt">eval =</span> <span class="ot">FALSE</span>)</a>
<a class="sourceLine" id="cb4-3" data-line-number="3">fun <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">check_arg</span>(<span class="st">&quot;digits&quot;</span>) <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">check_equal</span>()</a></code></pre></div>
<p>not all of the student submissions listed above would be accepted, because now <code>pi</code> is checked literally, as the string <code>&quot;pi&quot;</code>, not as the number <code>3.1415...</code>. Using <code>eval = FALSE</code> is interesting when you’re working with huge datasets and don’t want to compare their values exhaustively, or for objects for which the equality operator is not standard, such as SQL connections.</p>
</div>
</div>
<div id="example-2-multiple-function-calls" class="section level2">
<h2>Example 2: Multiple function calls</h2>
<p><code>index</code>, which is 1 by default, becomes important when there are several calls of the same function. Suppose that your exercise requires the student to call the <code>round()</code> function twice: once on <code>pi</code> and once on <code>exp(1)</code>, Euler’s number. A possible solution could be the following:</p>
<div class="sourceCode" id="cb5"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb5-1" data-line-number="1"><span class="co"># Call round on pi</span></a>
<a class="sourceLine" id="cb5-2" data-line-number="2"><span class="kw">round</span>(pi, <span class="dv">3</span>)</a>
<a class="sourceLine" id="cb5-3" data-line-number="3"></a>
<a class="sourceLine" id="cb5-4" data-line-number="4"><span class="co"># Call round on e</span></a>
<a class="sourceLine" id="cb5-5" data-line-number="5"><span class="kw">round</span>(<span class="kw">exp</span>(<span class="dv">1</span>), <span class="dv">3</span>)</a></code></pre></div>
<p>To test both these function calls, you’ll need the following SCT:</p>
<div class="sourceCode" id="cb6"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb6-1" data-line-number="1"><span class="kw">ex</span>() <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">check_function</span>(<span class="st">&quot;round&quot;</span>, <span class="dt">index =</span> <span class="dv">1</span>) <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">check_arg</span>(<span class="st">&quot;x&quot;</span>) <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">check_equal</span>()</a>
<a class="sourceLine" id="cb6-2" data-line-number="2"><span class="kw">ex</span>() <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">check_function</span>(<span class="st">&quot;round&quot;</span>, <span class="dt">index =</span> <span class="dv">2</span>) <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">check_arg</span>(<span class="st">&quot;x&quot;</span>) <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">check_equal</span>()</a>
<a class="sourceLine" id="cb6-3" data-line-number="3"><span class="kw">success_msg</span>(<span class="st">&quot;Two in a row, great!&quot;</span>)</a></code></pre></div>
<p>The first <code>check_function()</code> chain, where <code>index = 1</code>, checks the solution code for the first function call of <code>round()</code>, finds it - <code>round(pi, 3)</code> - and then goes to look through the student code to find a function call of <code>round()</code> that matches the arguments. It is perfectly possible that there are 5 function calls of <code>round()</code> in the student’s submission, and that only the fourth call matches the requirements for the first <code>check_function()</code> chain. As soon as a function call is found in the student code that passes all tests, <code>testwhat</code> heads over to the second <code>check_function()</code> chain, where <code>index = 2</code>. The same thing happens: the second call of <code>round()</code> is found from the solution code, and a match is sought for in the student code. This time, however, the function call that was matched before is now ‘blacklisted’; it is not possible that the same function call in the student code causes both <code>check_function()</code> chains to pass.</p>
<p>This means that all of the following student submissions would be accepted:</p>
<ul>
<li><code>round(pi, 3); round(exp(1), 3)</code></li>
<li><code>round(exp(1), 3); round(pi, 3)</code></li>
<li><code>round(pi, 3); round(123.456); round(exp(1), 3)</code></li>
<li><code>round(exp(1), 3); round(123.456); round(pi, 3)</code></li>
</ul>
<p>Of course, you can also specify all other arguments to customize your test, such as <code>eval</code>, <code>args</code>, <code>not_called_msg</code> and <code>incorrect_msg</code>.</p>
</div>
<div id="example-3-multiple-function-calls-2" class="section level2">
<h2>Example 3: Multiple function calls (2)</h2>
<p>When you’re checking a function call, <code>check_function()</code> will look for all ‘possible candidates’ to match the function call in the solution. This can have some nasty side effects, though. Similar to the previous example, suppose that you want the student to use <code>round()</code> twice, but you only want to test the second <code>round()</code> call:</p>
<div class="sourceCode" id="cb7"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb7-1" data-line-number="1"><span class="co"># Call round on pi</span></a>
<a class="sourceLine" id="cb7-2" data-line-number="2"><span class="kw">round</span>(pi, <span class="dv">3</span>)</a>
<a class="sourceLine" id="cb7-3" data-line-number="3"></a>
<a class="sourceLine" id="cb7-4" data-line-number="4"><span class="co"># Call round on e</span></a>
<a class="sourceLine" id="cb7-5" data-line-number="5"><span class="kw">round</span>(<span class="kw">exp</span>(<span class="dv">1</span>), <span class="dv">3</span>)</a></code></pre></div>
<p>An possible SCT would look like this then:</p>
<div class="sourceCode" id="cb8"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb8-1" data-line-number="1"><span class="kw">ex</span>() <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">check_function</span>(<span class="st">&quot;round&quot;</span>) <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">check_arg</span>(<span class="st">&quot;x&quot;</span>) <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">check_equal</span>()</a></code></pre></div>
<p>Suppose now that the student submits the following answer</p>
<div class="sourceCode" id="cb9"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb9-1" data-line-number="1"><span class="co"># Call round on pi</span></a>
<a class="sourceLine" id="cb9-2" data-line-number="2"><span class="kw">round</span>(pi, <span class="dv">3</span>)</a>
<a class="sourceLine" id="cb9-3" data-line-number="3"></a>
<a class="sourceLine" id="cb9-4" data-line-number="4"><span class="co"># Call round on e</span></a>
<a class="sourceLine" id="cb9-5" data-line-number="5"><span class="kw">round</span>(<span class="kw">exp</span>(<span class="dv">2</span>), <span class="dv">3</span>)</a></code></pre></div>
<p>If you try this out, you’ll see that <code>pi</code> will be highlighted, in the first call. This should be the second call, right? Here’s why it happens, step by step:</p>
<ul>
<li><code>check_function(&quot;round&quot;)</code> looks for all calls of <code>round()</code> in the student’s code. It finds two: on line 2 and on line 4.</li>
<li>Next, <code>check_arg(&quot;x&quot;)</code> checks whether the <code>x</code> argument is specified. It sees that both calls of <code>round()</code> do so, so both calls are still candidate to match the solution’s function call.</li>
<li>Next, <code>check-equal()</code> checks if the actual value of <code>x</code> carresponds to the value of that argument in the solution. More specifically, it looks for a <code>x</code> argument that equals <code>exp(1)</code>. It checks the <code>x</code> argument of the first <code>round()</code> call and sees it’s no good. Then it checks the <code>x</code> argument of the second <code>round()</code> call and sees it’s no good either. At this point the SCT fails, and simply the first function of the candidates, the one at line 2, is highlighted as the incorrect one.</li>
</ul>
<p>You can solve this by ‘ruling out’ the first <code>round()</code> call as a candidate, by simply using a <code>check_function()</code> chain beforehand:</p>
<div class="sourceCode" id="cb10"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb10-1" data-line-number="1"><span class="kw">ex</span>() <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">check_function</span>(<span class="st">&quot;round&quot;</span>, <span class="dt">index =</span> <span class="dv">1</span>) <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">check_arg</span>(<span class="st">&quot;x&quot;</span>) <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">check_equal</span>()</a>
<a class="sourceLine" id="cb10-2" data-line-number="2"><span class="kw">ex</span>() <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">check_function</span>(<span class="st">&quot;round&quot;</span>, <span class="dt">index =</span> <span class="dv">2</span>) <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">check_arg</span>(<span class="st">&quot;x&quot;</span>) <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">check_equal</span>()</a></code></pre></div>
<p>This way, the first <code>round()</code> call will not be considered as a candidate anymore by the time you’re checking the second <code>round()</code> call. If you submit the same student code for this SCT, you will see that highlighting happens correctly this time.</p>
</div>
<div id="example-4-advanced-automatic-feedback" class="section level2">
<h2>Example 4: Advanced Automatic Feedback</h2>
<p>The automatic messages that are generated when the student makes mistakes of different kinds is continuously improved to be as insightful as possible. For example, when the solution expects:</p>
<div class="sourceCode" id="cb11"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb11-1" data-line-number="1"><span class="kw">print</span>(<span class="fl">1.1234</span>)</a></code></pre></div>
<p>but the student submits:</p>
<div class="sourceCode" id="cb12"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb12-1" data-line-number="1"><span class="kw">print</span>(<span class="st">&quot;1.1234&quot;</span>)</a></code></pre></div>
<p>An SCT that contains <code>check_function(&quot;print&quot;) %&gt;% check_arg(&quot;x&quot;) %&gt;% check_equal()</code> will generate the message: “Have you correctly specified the argument <code>x</code> inside <code>print()</code>? You specified a character string, while it should be a number.”. When comparing character strings between student and solution, this comparison goes further, hinting about potential incorrect capitalization, incorrect spacing, incorrect punctuation or possible typos.</p>
</div>
<div id="example-5-...-argument" class="section level2">
<h2>Example 5: <code>...</code> argument</h2>
<p>Behind the scenes <code>check_function()</code> uses the <code>match.call()</code> function, to match the arguments to the function parameters. As an example, all of these different but equivalent ways to call the <code>grepl()</code> function:</p>
<div class="sourceCode" id="cb13"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb13-1" data-line-number="1"><span class="kw">grepl</span>(<span class="dt">pattern =</span> <span class="st">&quot;a{2}&quot;</span>, <span class="dt">x =</span> <span class="st">&quot;aabb&quot;</span>)</a>
<a class="sourceLine" id="cb13-2" data-line-number="2"><span class="kw">grepl</span>(<span class="dt">pat =</span> <span class="st">&quot;a{2}&quot;</span>, <span class="dt">x =</span> <span class="st">&quot;aabb&quot;</span>)</a>
<a class="sourceLine" id="cb13-3" data-line-number="3"><span class="kw">grepl</span>(<span class="st">&quot;a{2}&quot;</span>, <span class="dt">x =</span> <span class="st">&quot;aabb&quot;</span>)</a>
<a class="sourceLine" id="cb13-4" data-line-number="4"><span class="kw">grepl</span>(<span class="st">&quot;a{2}&quot;</span>, <span class="st">&quot;aabb&quot;</span>)</a>
<a class="sourceLine" id="cb13-5" data-line-number="5"><span class="kw">grepl</span>(<span class="dt">x =</span> <span class="st">&quot;aabb&quot;</span>, <span class="dt">pattern =</span> <span class="st">&quot;a{2}&quot;</span>)</a>
<a class="sourceLine" id="cb13-6" data-line-number="6"><span class="kw">grepl</span>(<span class="dt">x =</span> <span class="st">&quot;aabb&quot;</span>, <span class="st">&quot;a{2}&quot;</span>)</a></code></pre></div>
<p>Are converted into a standardized form by <code>match.call</code>:</p>
<div class="sourceCode" id="cb14"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb14-1" data-line-number="1"><span class="kw">grepl</span>(<span class="dt">pattern =</span> <span class="st">&quot;a{2}&quot;</span>, <span class="dt">x =</span> <span class="st">&quot;aabb&quot;</span>)</a></code></pre></div>
<p>That way, it’s easy to tell how each argument was specified.</p>
<p>However, in R, there’s the so-called ellipsis argument to pass arguments in a very free form, without having to list them in the function signature explicitly. They are typically used in an S3 context, where the arguments are dispatched to ‘lower level S3 functions’. <code>match.call()</code> cannot handle the ellipsis argument in a straightforward way.</p>
<p>In terms of argument matching in general, 4 things can happen:</p>
<ol style="list-style-type: decimal">
<li><p><code>match.call()</code> perfectly works, and every argument you pass is matched to an argument name, without any ellipsis problems.</p></li>
<li><p><code>check_fucntion()</code> figures out that you wanted to test an S3 function (<code>predict()</code> is a great example, it has a bunch of class-specific implementation). Based on the class of the first argument, it figures out the ‘more detailed’, class-specific implementation and tries to match the arguments to the signature of this more detailed function. NOTE: it is still possible that this signature features the <code>...</code> arguments, so the points below apply as well for this case.</p></li>
<li><p>The function call that <code>match.call()</code> has to standardize contains arguments that are matched to the ellipsis, but these arguments are named explicitly, for example the the <code>main</code> argument in <code>plot(mtcars$wt, mtcars$hp, main = 'mtcars plot')</code>. In this case, <code>match.call()</code> will match <code>mtcars$wt</code> to <code>x</code>, <code>mtcars$hp</code> to <code>y</code> and <code>'mtcars plot'</code> to <code>main</code>, just like for regular arguments.</p></li>
<li><p>The function call that <code>match.call()</code> has to standardize contains arguments that are matched to the ellipsis, but these arguments are not explicitly named. In this case, all ‘unnamed arguments’ are merged together in a list under the argument name <code>...</code>.</p></li>
</ol>
<p>Things become tricky if case 4 occurs: if a student specifies multiple arguments without naming them, and you want to check these arguments, you’ll need to use <code>&quot;...&quot;</code> inside your <code>args</code> function. However, be aware that this <code>&quot;...&quot;</code> part can represent a number of arguments that the student specified.</p>
<p>As an example, suppose you want to the student the calculate the sum of 1, 2, 3, 4, and <code>NA</code>. <code>sum()</code> supports the following approach:</p>
<div class="sourceCode" id="cb15"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb15-1" data-line-number="1"><span class="kw">sum</span>(<span class="dv">1</span>, <span class="dv">2</span>, <span class="dv">3</span>, <span class="dv">4</span>, <span class="ot">NA</span>, <span class="dt">na.rm =</span> <span class="ot">TRUE</span>)</a></code></pre></div>
<p>To test this:</p>
<div class="sourceCode" id="cb16"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb16-1" data-line-number="1"><span class="kw">ex</span>() <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">check_function</span>(<span class="st">&quot;sum&quot;</span>) <span class="op">%&gt;%</span><span class="st"> </span>{</a>
<a class="sourceLine" id="cb16-2" data-line-number="2">    <span class="kw">check_arg</span>(., <span class="st">&quot;...&quot;</span>) <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">check_equal</span>()</a>
<a class="sourceLine" id="cb16-3" data-line-number="3">    <span class="kw">check_arg</span>(., <span class="st">&quot;na.rm&quot;</span>) <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">check_equal</span>()</a>
<a class="sourceLine" id="cb16-4" data-line-number="4">}</a></code></pre></div>
<p>All of the following submissions will pass:</p>
<ul>
<li><code>sum(1, 2, 3, 4, NA, na.rm = TRUE)</code></li>
<li><code>sum(1, 1+1, 1+2, 1+3, NA, na.rm = TRUE)</code></li>
<li><code>sum(na.rm = TRUE, 1, 1+1, 1+2, 1+3, NA)</code></li>
</ul>
<p>However, none of the following submissions will pass (as you see, order is important):</p>
<ul>
<li><code>sum(1, 2, 3, 4, NA, na.rm = FALSE)</code></li>
<li><code>sum(1, 2, 3, NA, na.rm = TRUE)</code></li>
<li><code>sum(1, 2, 4, 3, NA, na.rm = TRUE)</code></li>
</ul>
<p>If the arguments that are matched to <code>...</code> are not correct, <code>check_equal()</code> will automatically generate the message:</p>
<pre><code>Check your call of `sum()`. Did you correctly specify the arguments that are matched to `...`?</code></pre>
<p>In this example of using the <code>sum()</code> function, using <code>test_function()</code> is a bad idea to start with. You also want to allow the student to use:</p>
<div class="sourceCode" id="cb18"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb18-1" data-line-number="1"><span class="kw">sum</span>(<span class="kw">c</span>(<span class="dv">1</span>, <span class="dv">2</span>, <span class="dv">3</span>, <span class="dv">4</span>, <span class="ot">NA</span>), <span class="dt">na.rm =</span> <span class="ot">TRUE</span>)</a></code></pre></div>
<p>which is perfectly valid as well. That’s why the following SCT would be more appropriate:</p>
<div class="sourceCode" id="cb19"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb19-1" data-line-number="1"><span class="kw">test_output_contains</span>(<span class="st">&quot;10&quot;</span>, <span class="dt">incorrect_msg =</span> <span class="st">&quot;Did you correctly print out the sum?&quot;</span>)</a></code></pre></div>
</div>
<div id="example-6-allowing-for-different-solutions" class="section level2">
<h2>Example 6: Allowing for different solutions</h2>
<p>A typical example of this is an exercise with the <code>plot()</code> function:</p>
<div class="sourceCode" id="cb20"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb20-1" data-line-number="1">df &lt;-<span class="st"> </span><span class="kw">data.frame</span>(<span class="dt">time =</span> <span class="kw">seq</span>(<span class="dv">0</span>, <span class="dv">2</span><span class="op">*</span>pi, <span class="fl">0.01</span>))</a>
<a class="sourceLine" id="cb20-2" data-line-number="2">df<span class="op">$</span>res &lt;-<span class="st"> </span><span class="kw">sin</span>(df<span class="op">$</span>time)</a>
<a class="sourceLine" id="cb20-3" data-line-number="3"></a>
<a class="sourceLine" id="cb20-4" data-line-number="4"><span class="co"># create a plot of res vs time</span></a>
<a class="sourceLine" id="cb20-5" data-line-number="5"><span class="kw">plot</span>(df<span class="op">$</span>time, df<span class="op">$</span>res)</a></code></pre></div>
<p>All of the following submissions should pass:</p>
<ul>
<li><code>plot(df$time, df$res)</code></li>
<li><code>plot(df[['time']], df[['res']])</code></li>
<li><code>plot(res ~ time, data = df)</code></li>
<li><code>plot(df$res ~ df$time)</code></li>
</ul>
<p>However, if you simply use the following SCT</p>
<div class="sourceCode" id="cb21"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb21-1" data-line-number="1"><span class="kw">test_function</span>(<span class="st">&quot;plot&quot;</span>, <span class="dt">args =</span> <span class="kw">c</span>(<span class="st">&quot;x&quot;</span>, <span class="st">&quot;y&quot;</span>))</a></code></pre></div>
<p>The third and fourth plot won’t work, because the solution code does not contain the calls to compare to. You can use the more granular <code>check_*()</code> functions in combination with <code>test_or()</code> and <code>override_solution()</code>. As the name suggests, this temporarily overrides the solution so that you can use <code>check_function()</code> for different possibilities.</p>
<div class="sourceCode" id="cb22"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb22-1" data-line-number="1"><span class="kw">test_or</span>({</a>
<a class="sourceLine" id="cb22-2" data-line-number="2">  fun &lt;-<span class="st"> </span><span class="kw">ex</span>() <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">check_function</span>(<span class="st">'plot'</span>)</a>
<a class="sourceLine" id="cb22-3" data-line-number="3">  fun <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">check_arg</span>(<span class="st">'x'</span>) <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">check_equal</span>()</a>
<a class="sourceLine" id="cb22-4" data-line-number="4">  fun <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">check_arg</span>(<span class="st">'y'</span>) <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">check_equal</span>()</a>
<a class="sourceLine" id="cb22-5" data-line-number="5">}, {</a>
<a class="sourceLine" id="cb22-6" data-line-number="6">  fun &lt;-<span class="st"> </span><span class="kw">ex</span>() <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">override_solution</span>(<span class="st">'plot(res ~ time, data = df)'</span>) <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">check_function</span>(<span class="st">'plot'</span>)</a>
<a class="sourceLine" id="cb22-7" data-line-number="7">  fun <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">check_arg</span>(<span class="st">'formula'</span>) <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">check_equal</span>()</a>
<a class="sourceLine" id="cb22-8" data-line-number="8">  fun <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">check_arg</span>(<span class="st">'data'</span>) <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">check_equal</span>()</a>
<a class="sourceLine" id="cb22-9" data-line-number="9">}, {</a>
<a class="sourceLine" id="cb22-10" data-line-number="10">  <span class="kw">ex</span>() <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">override_solution</span>(<span class="st">'plot(df$res ~ df$time)'</span>) <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">check_function</span>(<span class="st">'plot'</span>) <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">check_arg</span>(<span class="st">'formula'</span>) <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">check_equal</span>()</a>
<a class="sourceLine" id="cb22-11" data-line-number="11">})</a></code></pre></div>
<div id="example-6-function-results" class="section level3">
<h3>Example 6: Function results</h3>
<p>Suppose you want the student to call the sum function on a vector containing the values 1 to 5.</p>
<div class="sourceCode" id="cb23"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb23-1" data-line-number="1"><span class="co"># Calculate sum of vector 1 to 5</span></a>
<a class="sourceLine" id="cb23-2" data-line-number="2"><span class="kw">sum</span>(<span class="dv">1</span><span class="op">:</span><span class="dv">5</span>)</a></code></pre></div>
<p>One way to solve this is with <code>check_output_expr()</code>, but this does not explicitly require the student to use the <code>sum()</code> function. To make the usage of <code>sum()</code> explicit, you can use <code>test_function_result()</code>:</p>
<div class="sourceCode" id="cb24"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb24-1" data-line-number="1"><span class="kw">ex</span>() <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">check_function</span>(<span class="st">&quot;sum&quot;</span>) <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">check_result</span>() <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">check_equal</span>()</a>
<a class="sourceLine" id="cb24-2" data-line-number="2"><span class="kw">success_msg</span>(<span class="st">&quot;sweet&quot;</span>)</a></code></pre></div>
<p>The above SCT would accept all of the following submissions:</p>
<ul>
<li><code>sum(5:1)</code></li>
<li><code>sum(c(1, 2, 4, 3, 5))</code></li>
<li><code>x &lt;- c(1, 2, 3, 4, 5); sum(x)</code></li>
</ul>
</div>
</div>



<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    script.src  = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML";
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>

</body>
</html>
